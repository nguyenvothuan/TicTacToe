<html>

<body>
    <h1 style=" text-align: center">Welcome to Tic-Tac-Toe <br></h1>
    <h2 style="text-align: center">Human vs AI: Human first</h2>
    <canvas style="background-color: beige;" width="600" height="600"></canvas>
</body>
<style>
    .dot {
        height: 100px;
        width: 100px;
        border-radius: 100%;
        /* rounds corners */
        background: blue;
        position: inherit;
    }


    canvas {
        padding: 0;
        margin: auto;
        display: block;
        position: relative;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
</style>
<script>
    function gameStart() {
        //initialize canvas
        ctx = document.querySelector('canvas').getContext('2d');
        ctx.lineWidth = 7;
        ctx.beginPath();
        ctx.font = "150px Arial";
        ctx.moveTo(0, 0); ctx.lineTo(600, 0);
        ctx.lineTo(600, 600);
        ctx.lineTo(0, 600);
        ctx.lineTo(0, 0);
        ctx.moveTo(200, 0);
        ctx.lineTo(200, 600);
        ctx.moveTo(400, 0);
        ctx.lineTo(400, 600);
        ctx.moveTo(0, 200);
        ctx.lineTo(600, 200);
        ctx.moveTo(0, 400);
        ctx.lineTo(600, 400);
        board = [
            [-100, -100, -100],
            [-100, -100, -100],
            [-100, -100, -100]
        ]
        canvas = document.querySelector('canvas');


        //game play here.
        document.addEventListener('click', (event) => {
            arr = getMousePosition(canvas, event);
            x = arr[0]; y = arr[1];//when x is the top axis, y is the left one.
            coordBoard = findCoordBoard(x, y); coordCanvas = findCoordCanvas(x, y);
            if (board[coordBoard[1]][coordBoard[0]] == -100) {//if no one plays here yet. Remember to swap the position of x y whe applying to the board's arr
                drawHuman(ctx, coordCanvas[0], coordCanvas[1]); //display human's move
                board[coordBoard[1]][coordBoard[0]] = 1; //update board with human's move for AI to compute
                if (isWon(board)==1)
                {//human wins
                    alert('Human wins. Click ok to reload.');
                    window.location.reload(true);
                }
                if (isWon(board)==2){//reach 9 moves and not win, drawn is declared 
                    alert('Drawn. Click ok to reload');
                    window.location.reload(true);
                }
                //neither human wins nor drawn. AI can move.
                aiMove = moveAI(board);//find the best move for AI
                board[aiMove[0]][aiMove[1]] = 0;//update board with AI's move
                drawAI(ctx, aiMove[1], aiMove[0]); //function drawAI use board Coord to draw instead of page location
                
                //check status. AI has just played so there are two cases: either AI wins or nothing happens.Human cannot win here
                if (isWon(board) == -1) {
                    alert('Nice try but you lost.\n Click ok to reload this page');
                    window.location.reload(true);
                }
            }
        })

        ctx.stroke();
    }

    function moveAI(board) {//return a tuple of (x,y) in AI's turn, parameterized with. Only used when there is at least 1 more square for AI to move
        //1 is human's move. 0 is AI's move. Randomize the next move until find out an empty cell. Return this cell
        //Because we have checked that there is at least 1 empty cell, this must be true;
        while (true) {
            x = Math.floor(Math.random() * 3);
            y = Math.floor(Math.random() * 3);

            if (board[x][y] == -100)
                break;
        }
        console.log("AI move:" + x + " " + y);
        return [x, y];
    }

    function getMousePosition(canvas, event) {//return coord of X, Y relative to the canvas
        let rect = canvas.getBoundingClientRect();
        let x = event.clientX - rect.left;
        let y = event.clientY - rect.top;
        return [x, y];
    }

    function findCoordBoard(x, y) {//return indices of the last click to update it to the board
        let realX, realY;
        if (x < 200) {
            realX = 0;
        } else if (x < 400) {
            realX = 1;
        } else if (x < 600) {
            realX = 2;
        }
        if (y < 200) {
            realY = 0;
        } else if (y < 400) {
            realY = 1;
        } else if (y < 600) {
            realY = 2;
        }
        return [realX, realY];
    }

    function findCoordCanvas(x, y) {//find the center coordinate on the canvas to supple either drawAI or drawHuman

        let realX, realY;
        if (x < 200) {
            realX = 100;
        } else if (x < 400) {
            realX = 300;
        } else if (x < 600) {
            realX = 500;
        }
        if (y < 200) {
            realY = 100;
        } else if (y < 400) {
            realY = 300;
        } else if (y < 600) {
            realY = 500;
        }
        return [realX, realY];
    }

    function drawHuman(ctx, x, y) {//draw human's move on the canvas
        let arr = findCoordCanvas(x, y);

        ctx.fillStyle = "red";
        ctx.fillText('X', x - 50, y + 50);

    }

    function drawAI(ctx, x, y) {//use when moveAI is called and draw such move on the canvas
        let realX, realY;
        if (x == 0) {
            realX = 100;
        } else if (x == 1) {
            realX = 300;
        } else if (x == 2) {
            realX = 500;
        }

        if (y == 0) {
            realY = 100;
        } else if (y == 1) {
            realY = 300;
        } else if (y == 2) {
            realY = 500;
        }
        ctx.fillStyle = "blue";
        ctx.fillText('O', realX - 50, realY + 50);
    }

    function isWon(board) {//human 1, ai 0 on the board. return 1 if human wins, -1 if ai wins, 0 if nothing yet, 2 if drawn. In case of a drawn game, check if count = 9 
        if (areAllEqual(board[0][0], board[1][1], board[2][2], 1) ||//diagonal \
            areAllEqual(board[0][2], board[1][1], board[2][0], 1) ||//diagonal /
            areAllEqual(board[0][0], board[1][0], board[2][0], 1) ||
            areAllEqual(board[0][1], board[1][1], board[2][1], 1) ||
            areAllEqual(board[0][2], board[1][2], board[2][2], 1) ||//vertical 
            areAllEqual(board[0][0], board[0][1], board[0][2], 1) ||
            areAllEqual(board[1][0], board[1][1], board[1][2], 1) ||
            areAllEqual(board[2][0], board[2][1], board[2][2], 1)//horizontal
        ) {
            return 1;
        }
        if (areAllEqual(board[0][0], board[1][1], board[2][2], 0) ||//diagonal \
            areAllEqual(board[0][2], board[1][1], board[2][0], 0) ||//diagonal /
            areAllEqual(board[0][0], board[1][0], board[2][0], 0) ||
            areAllEqual(board[0][1], board[1][1], board[2][1], 0) ||
            areAllEqual(board[0][2], board[1][2], board[2][2], 0) ||//vertical 
            areAllEqual(board[0][0], board[0][1], board[0][2], 0) ||
            areAllEqual(board[1][0], board[1][1], board[1][2], 0) ||
            areAllEqual(board[2][0], board[2][1], board[2][2], 0)//horizontal
        ) {
            return -1;
        }
        let count = 0;
        board.forEach(subarr => {
            subarr.forEach(elem => {
                if (elem != -100) { count++ };
            })
        });
        if (count == 9) {
            return 2;//neither won nor lost, then drawn
        }
        return 0; //no shit happened yet
    }

    function areAllEqual(x, y, z, val) {//check if x==y==z!=null
        if (x == y && y == z && x == 1)
            return true;
        return false;
    }

    gameStart();
</script>

</html>